## 短线自动重连适用场景

### 场景1

```
在一组服务之间，如果其中 些服务(主动连接方，以下简称 A) 需要与另服务(被动连接方，以下简称 B) 建立 TCP 长连接，而A没有自动连接B的功能，那么在部署或者测试这些服务时，必须先启动B再启动 A，因为一旦先启动A此时尝试连接 B( 由于B还没有启动)就会失败，之后A再也不会连接B了(即使 随后被启动) , 
从而导致整个系统不能正常工作。
```

### 场景2

```
在部署或测试时，先启动B再启动A，A/B之间的连接在运行期间可能由于网络波动等原因 断开，整个系统不能再正常工作
```

### 场景3

```
如果我们想升级B，则更新完程序后重启B时也必须重启A.如果这种依赖链较长(例如A连接B，B连接C，C连接D等等) ，那么更新某个程 的效率会很低，更新成本非常高
```

### 场景4

```
对于客户端软件来说，如果因为用户的网络短暂故障导致客户端与服务器失去连接，那么等网络恢复后，较好的用户体验是客户端检测到用户网络变化时自动与服务器重连，以便用户及时收到最新的消息
```

## 重连机制的实现

```
重连本身的功能开发很简单，其实就是调用套接字的 connect 函数不断重试，重试的技巧非常有讲究。
```

### 服务器端：

```
对于服务端程序，例如A连接B，如果连接不上，整个系统则将无法工作
以开发A服务时，重连的逻辑可以很简单：A旦发现与B断开了连接，就尝试与B重新连接，如果连接不上，则隔一段时间再重试( 般设置为3秒或5秒即可），在此期间可以发送报警邮件或者输出错误日志，让开发人员或者
运维人员尽快干预，尽快解决问题
```

### 客户端：

```
1.客户端所处的网络环境比服务器程序所处的网络环境 般要恶劣得多，以相等的时间间隔定时重连，一般作用不大(例如用户拔掉了网线) 因此对于客户端软件，出现断线时会尝试去重连，如果连接不上，则会隔一个比前 次时间间隔更长的时间间隔去重连，
2.如果网络发生波动，程序就应该检测网络状态，如果网络状态恢复正常 就应该立即进行一次重连，而不是一成不变地按照设置的时间间隔重连。
3.
```

## 技术上的短线重连和业务上的断线重连

```
技术上的断线重连指的是调用 connect 函数连接 在实际开发中，大多数系统只实现技术上的重连成功(即 connect 连接成功)是没有任何意义的，在网络连接成功后，还需要再次向服务器发送账号验证信息等(如登录数据包)，在这些信息验签成功后，才叫作真正的重连成功 这里说的发送账号验证信息并验签成功就是指业务上的重连成功 在复杂的系统中可能需要连续进行几个验签流程 因此，我们若想设计完备的断线重连机制，
则不仅要考虑技术上的重连，还要考虑、业务上的重连。
```

